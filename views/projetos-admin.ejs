<%- include('partials/header') %>

<main class="container">
    <h1>Gerenciar Projetos</h1>

    <section>
        <h2>Projetos Cadastrados</h2>
        <br>
        <% if (listaDeProjetos && listaDeProjetos.length > 0) { %>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="text-align: left; border-bottom: 2px solid #333;">
                        <th>Nome</th>
                        <th>Tecnologias</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <% listaDeProjetos.forEach(projeto => { %>
                        <tr style="border-bottom: 1px solid #ccc;">
                            <td style="padding: 10px;"><%= projeto.nome %></td>
                            <td><%= projeto.tecnologias %></td>
                            <td>
                                <a href="/admin/edit/<%= projeto.id %>" class="btn-edit">Editar</a>
                                <button onclick="deletarProjeto(<%= projeto.id %>)" class="btn-delete" style="background-color: #d9534f; color: white; border: none; padding: 5px 10px; cursor: pointer;">Excluir</button>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        <% } else { %>
            <p>Nenhum projeto cadastrado.</p>
        <% } %>
    </section>

    <hr style="margin: 40px 0;">

    <section>
        <h2>Adicionar Novo Projeto</h2>
        <form action="/admin/add-project" method="POST" style="display: flex; flex-direction: column; gap: 15px; max-width: 500px;">
            <label>
                Nome do Projeto:
                <input type="text" name="nome" required style="width: 100%; padding: 8px;">
            </label>

            <label>
                Descrição:
                <textarea name="descricao" required rows="4" style="width: 100%; padding: 8px;"></textarea>
            </label>

            <label>
                Tecnologias (ex: Node.js, MySQL):
                <input type="text" name="tecnologias" required style="width: 100%; padding: 8px;">
            </label>

            <label>
                Link (GitHub/Deploy):
                <input type="text" name="link" style="width: 100%; padding: 8px;">
            </label>

            <button type="submit" style="padding: 10px; background-color: #28a745; color: white; border: none; cursor: pointer;">Salvar Projeto</button>
        </form>
    </section>
</main>

<script>
    function deletarProjeto(id) {
        if(confirm("Tem certeza que deseja excluir este projeto?")) {
            // O caminho aqui deve bater EXATAMENTE com a rota no index.ts
            fetch('/admin/projetos/delete/' + id, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();
                } else {
                    alert("Erro ao excluir: " + (data.error || "Erro desconhecido"));
                    console.error(data.error);
                }
            })
            .catch(err => {
                alert("Erro de conexão com o servidor.");
                console.error(err);
            });
        }
    }
</script>

<%- include('partials/footer') %>